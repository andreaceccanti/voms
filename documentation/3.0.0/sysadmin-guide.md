---
layout: default
title: VOMS System Administrator Guide
---

# VOMS System Administrator guide

#### Table of contents
* [Introduction](#Intro)
* [Prerequisites and recommendations](#Prereq)
* [Upgrade instructions](#Upgrade)
* [Installation instructions](#Installation)
* [Configuration instructions](#Configuration)
* [Service operation](#Operation)
* [Service migration](#Migration)
* [Troubleshooting](#Troubleshooting)

## Introduction <a name="Intro">&nbsp;</a>

The Virtual Organization Membership Service (VOMS) is an attribute authority
which serves as central repository for VO user authorization information,
providing support for sorting users into group hierarchies, keeping track of
their roles and other attributes in order to issue trusted attribute
certificates and SAML assertions used in the Grid environment for authorization
purposes.
 
## Prerequisites and recommendations <a name="Prereq">&nbsp;</a>

### Hardware

* CPU: No specific requirements
* Memory: 2GB if serving <= 15 VOs, more otherwise
* Disk: 10GB free space (besides OS and EMI packages)

### Operating system

* NTP Time synchronization: required.
* Host certificates: required
* Networking: for the service ports see the [Service Reference Card](service-ref-card.html)

### Installed software

Besides the usual OS and EMI release packages, in case of an Oracle based installation you will need the **oracle-instantclient-basic** package, version 11.2.0.3,
as repackaged by CERN:

```bash
yum localinstall oracle-instantclient-basic-11.2.0.3-1.x86_64.rpm
```

All the other dependencies are resolved by the installation of the VOMS metapackages, i.e.:

* **emi-voms-mysql**, in case of a MySQL installation,
* **emi-voms-oracle**, in case of an Oracle installation.

### Recommended deployment scenarios

A single-node installation, with the hardware recommendations given above should serve well most scenarios.
Serving a large number of VOs (> 15) will require more memory and disk space.

## Upgrade instructions <a name="Upgrade">&nbsp;</a>

The upgrade from gLite 3.2 is **not supported**. Upgrade to EMI 1 or 2 and then upgrade to the latest VOMS release.

### Upgrade preparation

It is always a good idea to dump the contents of the VOMS database. For MySQL-based installation follow
the instructions in the [database migration section](#Migration).

Also archive the configuration files for VOMS and VOMS-Admin, which live in the following directories:
```
/etc/voms
/etc/voms-admin
```

### EMI repository configuration

Follow the [general EMI 3 installation instructions](https://twiki.cern.ch/twiki/bin/view/EMI/GenericInstallationConfigurationEMI3) for installing the EMI-3 repositories. 

### Upgrade <a name="Upgrading">&nbsp;</a>

Before upgrading, stop the running VOMS services issuing the following commands

```bash
service voms stop
service voms-admin stop
```

and stop the tomcat service:

```bash
service tomcat5 stop (SL5)
service tomcat6 stop (SL6)
```

Run the following commands:

```bash
yum clean all
yum update
```

This will update the VOMS packages to the latest version. 

You can then remove Apache Tomcat (tomcat5 or tomcat6 depending on the SL version) as it is no longer
needed to run VOMS Admin.

Older versions of VOMS and VOMS Admin needed a few environment variables to be set. This is no longer true, 
so please unset them this command

```bash
unset VOMS_LOCATION_CONF VOMS_ADMIN_LOCATION_VAR VOMS_LOCATION VOMS_LOCATION_VAR VOMS_ADMIN_LOCATION
```

and remove any reference to the above environment variables from the file `/etc/profile.d/grid-env.sh`, which
was generated by YAIM.

### Configuring the VOMS Admin container <a name="ContainerConf">&nbsp;</a>

Since version 3.0.1 VOMS Admin does not depend anymore on Tomcat but uses an embedded Jetty container for running the
VO web applications. Please set the host, port and ssl information by editing the 

```
/etc/voms-admin/voms-admin-server.properties
```

before reconfiguring the VOs (as explained in the following sections) or start the voms-admin server.

#### Configuring file limits for the VOMS Admin container

It is safe to configure the VOMS Admin container to have a reasonable limit for the number of open files that can be opened by the voms-admin process (which runs as user `voms`). The default file limit can be modified by editing the `/etc/security/limits.conf` file:

```
voms          soft    nofile  63536
voms          hard    nofile  63536
```

#### Configuring memory for the VOMS Admin container

The default Java VM memory configuration for the VOMS Admin container is suitable for deployments which have at max 10 VOs
configured, and is set in the voms-admin init script:

```bash
VOMS_JAVA_OPTS="-Xms256m -Xmx512m -XX:MaxPermSize=512m"
```

In case your server will host more VOs, you should adapt the memory configuration for the container accordingly.
This can be done by setting the `VOMS_JAVA_OPTS` variable in the `/etc/sysconfig/voms-admin` file.
We recommend to allocate roughly 50m of heap space and 75m of permanent space per VO.
For example, for 15 VOs, the memory should be configued as follows:

```bash
VOMS_JAVA_OPTS="-Xms375m -Xmx750m -XX:MaxPermSize=1125m"
```

### Reconfiguring the VOs

The upgrade to EMI3 requires a reconfiguration of the deployed VOs. The VOs can be reconfigured using the `voms-configure` configuration tool (YAIM is no longer supported).

This tool is the evolution of the `voms-admin-configure` script, and provides access to all the VOMS
and VOMS-Admin service configuration parameters. For more detailed information about the `voms-configure` tool, see the [VOMS Admin user's guide](#tbd).

The following command shows a basic reconfiguration of the VO:

```bash
voms-configure install \
--vo <vo_name> \
--hostname <hostname> \
--dbname <dbname> \
--dbusername <dbusername> \
--dbpassword <dbpassword> \
--core-port 15000 \
--mail-from <mail-from> \
--smtp-host <smtp-host>
```

Once the configuration is over you can restart the VOMS services:

```bash
service voms start
service voms-admin start
```

### Reconfiguring the information system

Configuration files for voms information providers are now provided by voms. In order to properly configure
the informaton provider for voms follow the instructions [here](#bdii).

If you wish to configure EMIR follow the instructions [here](#EMIR).

## Clean installation instructions<a name="Installation">&nbsp;</a>

These are the full instructions for a clean installation. If you are upgrading, see the [upgrade instructions section](#Upgrading).

### Repositories

Follow the [general EMI 3 installation instructions](https://twiki.cern.ch/twiki/bin/view/EMI/GenericInstallationConfigurationEMI3)

### Certificate revocation lists

Following the EMI-3 installation instructions you have installed the EGI IGTF certification authorities certificates. To enable periodically fetching certificate revocation lists, run the fetch-crl script

```bash
/usr/sbin/fetch-crl
```

and enable a cron job that periodically refresh CRLs on the filesystem as follows:

```bash
/sbin/chkconfig fetch-crl-cron on
/sbin/service fetch-crl-cron start
```
### Clean installation

Install the `emi-voms-mysql` metapackage, or `emi-voms-oracle` depending on the database backend you are using
```bash
yum install emi-voms-mysql
```

## Configuration instructions <a name="Configuration">&nbsp;</a>

VOMS is now configured only using its own configuration utility, *voms-configure*. YAIM configuration for this version of VOMS is **not supported**.
